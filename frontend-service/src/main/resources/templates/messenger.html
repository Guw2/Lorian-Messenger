<html>
	<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
	<head>
		<title>Messenger</title>
		<meta charset="UTF-8">
	</head>
	<body>
		<h1>Messenger</h1>
		<input id="inputMessage" type="text" />
		<button onclick="sendMessage()">Submit</button>
		<div id="chat"></div>
	</body>
	<script type="text/javascript">
	
		function connect(){
			const socket = new SockJS('http://localhost:8082/ws-chat');
			stompClient = Stomp.over(socket);
			
			stompClient.connect({}, function (frame){
				console.log('Conectado: ' + frame);
				
				stompClient.subscribe('/topic/public', function (messageOutput){
					const message = JSON.parse(messageOutput.body);
					showMessageOnScreen(message);
				});
			});
		}
		
		function sendMessage(){
			const content = document.getElementById("inputMessage").value;
			
			stompClient.send("/app/chat.send", {}, JSON.stringify({
				sender: "user-example",
				content: content,
				timestamp: new Date().toISOString()
			}))
		}
		
		function showMessageOnScreen(message){
			const chat = document.getElementById("chat");
			const newMessage = document.createElement("div");
			newMessage.innerText = `[${message.timestamp}] ${message.sender} : ${message.content}`;
			chat.appendChild(newMessage);
		}
		
		connect();
	</script>
</html>